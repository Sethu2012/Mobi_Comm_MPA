<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MOBI-COMM Recharge</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
        integrity="sha512-9usAa10IRO0HhonpyAIVpjrylPvoDwiPUiKdWk5t3PyolY1cOd4DSE0Ga+ri4AuTroPR5aQvXU9xC6qOPnzFeg=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
    <style>
        .payment-option {
            border: 1px solid #ccc;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 5px;
            cursor: pointer;
        }

        .payment-option:hover {
            background-color: #f9f9f9;
        }

        .invalid-feedback {
            display: none;
            /* Initially hide the feedback */
            color: red;
            /* Set error message color to red */
        }

        .is-invalid+.invalid-feedback {
            display: block;
            /* Show feedback if input is invalid */
        }

        body {
            position: relative;
        }

        /* Increase container height and responsiveness */
        .recharge_container {

            /* Minimum height for the container */
            height: auto;
            /* Allows the container to grow in height */
            margin-bottom: 50px;
            /* Add some spacing before the footer */
        }

        /* Style for the payment success overlay */
        #paymentSuccess {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 80%;
            /* Adjust as needed */
            max-width: 500px;
            /* Maximum width */
            background-color: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            z-index: 1001;
            text-align: center;
        }

        /* Style to blur the background */
        /* .blur {
            filter: blur(5px);
            -webkit-filter: blur(5px);
           
            transition: filter 0.3s;
        } */

        /* Style for the overlay (to cover the entire page) */
        #overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            /* Semi-transparent background */
            z-index: 1000;
            /* Ensure it's above other content but below the success message */
        }

        /* Footer */
        .footer {
            background-color: #476147;
            /* Updated color palette */
            color: white;
            padding: 2rem 0;
            text-align: center;
        }

        .footer-content {
            display: flex;
            justify-content: space-around;
            margin-bottom: 1rem;
        }

        .footer-col h3 {
            margin-bottom: 0.75rem;
        }

        .footer-col a {
            color: white;
            text-decoration: none;
            display: block;
            margin-bottom: 0.5rem;
        }

        .social-icons a {
            color: white;
            margin: 0 0.5rem;
            text-decoration: none;
        }

        .footer-bottom {
            border-top: 1px solid rgba(255, 255, 255, 0.2);
            padding-top: 1rem;
        }

        .footer-links a {
            margin: 0 0.5rem;
            text-decoration: none;
        }

        /* Media Queries for Responsiveness */
        @media (max-width: 768px) {
            .footer-content {
                flex-direction: column;
                align-items: center;
            }

            .footer-col {
                margin-bottom: 2rem;
            }

            #paymentSuccess {
                width: 90%;
                /* Adjust width for smaller screens */
            }
        }

        .custom-bg {
    background-color: #476147 !important;
    border-color: #476147 !important;
}
    </style>
</head>

<body>

    <!-- Header -->
    <header class="bg-white shadow-sm p-3 mb-5">
        <div class="container d-flex justify-content-between align-items-center">
            <div class="d-flex align-items-center">
                <img src="Logo-removebg-preview.png" alt="Mobi-Comm Logo" class="logo" height="50">
            </div>
            <nav class="nav">
                <a href="Home.html" class="nav-link text-dark">Home</a>
                <a href="Plans_Page.html" class="nav-link text-dark">Plans</a>
                <a href="Plans_Page.html" class="nav-link text-dark">Recharge</a>
                <a href="#" class="nav-link text-dark">Support</a>
                <a href="#" class="nav-link text-dark">Contact Us</a>
            </nav>
            <div>
                <img src="profile-user.png" alt="Profile Icon" class="rounded-circle" height="40">
            </div>
        </div>
    </header>

    <!-- Recharge Content -->
    <div class="recharge_container">
        <h2 class="text-center mb-4">Recharge</h2>

        <div class="row justify-content-center">
            <div class="col-md-8">
                <button class="btn btn-secondary mb-3" onclick="goBack()" style="background-color: #476147; border-color: #476147;">
                    <i class="fas fa-arrow-left"></i> Back
                </button>
                

                <div class="mb-3">
                    <label for="selectedPlan" class="form-label">Selected Plan:</label>
                    <input type="text" class="form-control" id="selectedPlan" value="" readonly>
                    <br>
                    <input type="hidden" id="planPrice" value="">
                    <label for="planPriceDisplay" class="form-label">Plan Price:</label>
                    <input type="text" class="form-control" id="planPriceDisplay" value="" readonly>
                </div>

                <h4>Select Payment Method:</h4>
                <div class="payment-option" onclick="selectPayment('gpay')">
                    <i class="fab fa-google-pay"></i> GPay (UPI)
                </div>
                <div class="payment-option" onclick="selectPayment('phonepe')">
                    <i class="fab fa-phoenix-framework"></i> PhonePe (UPI)
                </div>
                <div class="payment-option" onclick="selectPayment('credit_card')">
                    <i class="far fa-credit-card"></i> Credit Card
                </div>
                <div class="payment-option" onclick="selectPayment('amazon_pay')">
                    <i class="fab fa-amazon-pay"></i> Amazon Pay
                </div>
                <div class="payment-option" onclick="selectPayment('razorpay')">
                    <i class="fas fa-rupee-sign"></i> Razorpay
                </div>

                <div id="paymentFormContainer">
                    <!-- Payment form will be dynamically loaded here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Payment successful simulation -->
    <div id="overlay"></div>
    <div id="paymentSuccess">
        <h1>Payment Successful!</h1>
        <p id="successPlanName">Plan Name: </p>
        <p id="successPrice">Price: </p>
        <p id="successUpiId">UPI ID: </p>
        <p>Transaction ID: <span id="transactionId"></span></p>
        <p id="successMessage">Your recharge was successful!</p>
        <button onclick="closeSuccess()">Close</button>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <div class="footer-content">
            <div class="footer-col">
                <h3>Product</h3>
                <a href="#">Landing Page</a>
                <a href="#">Popup Builder</a>
                <a href="#">Web-design</a>
                <a href="#">Content</a>
                <a href="#">Integrations</a>
            </div>

            <div class="footer-col">
                <h3>Use Cases</h3>
                <a href="#">Web-designers</a>
                <a href="#">Marketers</a>
                <a href="#">Small Business</a>
                <a href="#">Website Builder</a>
            </div>

            <div class="footer-col">
                <h3>Resources</h3>
                <a href="#">Academy</a>
                <a href="#">Blog</a>
                <a href="#">Themes</a>
                <a href="#">Hosting</a>
                <a href="#">Developers</a>
                <a href="#">Support</a>
            </div>

            <div class="footer-col">
                <h3>Company</h3>
                <a href="#">About Us</a>
                <a href="#">Careers</a>
                <a href="#">FAQs</a>
                <a href="#">Teams</a>
                <a href="#">Contact Us</a>
            </div>
        </div>

        <div class="social-icons">
            <a href="#">•</a>
            <a href="#">•</a>
            <a href="#">•</a>
            <a href="#">•</a>
            <a href="#">•</a>
        </div>

        <div class="footer-bottom">
            <span>© 2025 Mobi-Comm. All Rights Reserved</span>
            <div class="footer-links">
                <a href="#">Privacy Policy</a>
                <a href="#">Terms of Use</a>
                <a href="#">Sales and Refunds</a>
                <a href="#">Legal</a>
                <a href="#">Site Map</a>
            </div>
        </div>
    </footer>

    <script>
        function goBack() {
            window.history.back();
        }

        function getParameterByName(name, url = window.location.href) {
            name = name.replace(/[\[\]]/g, '\\$&');
            var regex = new RegExp('[?&]' + name + '(=([^&#]*)|&|#|$)'),
                results = regex.exec(url);
            if (!results) return null;
            if (!results[2]) return '';
            return decodeURIComponent(results[2].replace(/\+/g, ' '));
        }

        document.addEventListener('DOMContentLoaded', function () {
            const planName = getParameterByName('planName');
            const planPrice = getParameterByName('planPrice');

            if (planName && planPrice) {
                document.getElementById('selectedPlan').value = planName;
                document.getElementById('planPrice').value = planPrice;
                document.getElementById('planPriceDisplay').value = planPrice; // Display with currency symbol
            }
        });

        function selectPayment(method) {
            const planPrice = document.getElementById('planPrice').value;
            const planName = document.getElementById('selectedPlan').value;
            let paymentFormHTML = '';
            switch (method) {
                case 'gpay':
                    paymentFormHTML = `
                        <h4>GPay (UPI)</h4>
                        <p>You will be redirected to GPay to complete your payment.</p>
                        <div class="mb-3">
                            <label for="upiId" class="form-label">UPI ID:</label>
                            <input type="text" class="form-control" id="upiId" placeholder="Enter UPI ID" required
                                onkeypress="handleEnter(event, 'gpay', '${planName}', '${planPrice}')">
                            <div class="invalid-feedback">Please enter a valid UPI ID.</div>
                        </div>
                        <button class="btn btn-primary custom-bg"
                            onclick="processPayment('gpay', '${planName}', '${planPrice}')">Pay with GPay</button>
                    `;
                    break;
                case 'phonepe':
                    paymentFormHTML = `
                        <h4>PhonePe (UPI)</h4>
                        <div class="mb-3">
                            <label for="upiId" class="form-label">UPI ID:</label>
                            <input type="text" class="form-control" id="upiId" placeholder="Enter UPI ID" required
                                onkeypress="handleEnter(event, 'phonepe', '${planName}', '${planPrice}')">
                            <div class="invalid-feedback">Please enter a valid UPI ID.</div>
                        </div>
                        <button class="btn btn-primary custom-bg"
                            onclick="processPayment('phonepe', '${planName}', '${planPrice}')">Pay with PhonePe</button>
                    `;
                    break;
                case 'credit_card':
                    paymentFormHTML = `
                        <h4>Credit Card Details</h4>
                        <div class="mb-3">
                            <label for="cardNumber" class="form-label">Card Number:</label>
                            <input type="text" class="form-control" id="cardNumber" placeholder="Enter card number"
                                required onkeypress="handleEnter(event, 'credit_card', '${planName}', '${planPrice}')">
                            <div class="invalid-feedback">Please enter a valid card number.</div>
                        </div>
                        <div class="mb-3">
                            <label for="expiryDate" class="form-label">Expiry Date:</label>
                            <input type="text" class="form-control" id="expiryDate" placeholder="MM/YY" required
                                onkeypress="handleEnter(event, 'credit_card', '${planName}', '${planPrice}')">
                            <div class="invalid-feedback">Please enter a valid expiry date (MM/YY).</div>
                        </div>
                        <div class="mb-3">
                            <label for="cvv" class="form-label">CVV:</label>
                            <input type="text" class="form-control" id="cvv" placeholder="CVV" required
                                onkeypress="handleEnter(event, 'credit_card', '${planName}', '${planPrice}')">
                            <div class="invalid-feedback">Please enter a valid CVV.</div>
                        </div>
                        <button class="btn btn-primary custom-bg"
                            onclick="processPayment('credit_card', '${planName}', '${planPrice}')">Pay with Credit
                            Card</button>
                    `;
                    break;
                case 'amazon_pay':
                    paymentFormHTML = `
                        <h4>Amazon Pay</h4>
                        <p>You will be redirected to Amazon Pay to complete your payment.</p>
                        <button class="btn btn-primary custom-bg"
                            onclick="processPayment('amazon_pay', '${planName}', '${planPrice}')">Pay with Amazon
                            Pay</button>
                    `;
                    break;
                case 'razorpay':
                    paymentFormHTML = `
                        <h4>Razorpay</h4>
                        <p>You will be redirected to Razorpay to complete your payment.</p>
                        <button class="btn btn-primary custom-bg"
                            onclick="processPayment('razorpay', '${planName}', '${planPrice}')">Pay with Razorpay</button>
                    `;
                    break;
                default:
                    paymentFormHTML = '<p>Invalid payment method selected.</p>';
            }

            document.getElementById('paymentFormContainer').innerHTML = paymentFormHTML;
        }

        function isValidUPI(upiId) {
    // UPI ID should match the format: prefix@bankdomain
    const upiRegex = /^[a-zA-Z0-9.\-_]{3,}@[a-zA-Z0-9]+(\.[a-zA-Z]{2,})+$/;

    return upiRegex.test(upiId);
}


function isValidCardNumber(cardNumber) {
    if (!cardNumber) return false; // Handle null, undefined, and empty input

    // Remove all non-digit characters
    const cleanCardNumber = cardNumber.replace(/\D/g, '');

    // Basic length check (valid credit cards have 13 to 19 digits)
    if (cleanCardNumber.length < 13 || cleanCardNumber.length > 19) {
        return false;
    }

    // Luhn Algorithm implementation
    let sum = 0;
    let shouldDouble = false;

    for (let i = cleanCardNumber.length - 1; i >= 0; i--) {
        let digit = parseInt(cleanCardNumber[i], 10);

        if (shouldDouble) {
            digit *= 2;
            if (digit > 9) {
                digit -= 9;
            }
        }

        sum += digit;
        shouldDouble = !shouldDouble; // Toggle for next iteration
    }

    return sum % 10 === 0;
}

        // Mock implementation of expiry date validation
        function isValidExpiryDate(expiryDate) {
            if (!/^(0[1-9]|1[0-2])\/\d{2}$/.test(expiryDate)) {
                return false;
            }

            const [month, year] = expiryDate.split('/').map(Number);
            const currentYear = new Date().getFullYear() % 100; // Get last two digits of current year
            const currentMonth = new Date().getMonth() + 1;

            if (year < currentYear || year > currentYear + 10) { // Restrict to 10 years in the future
                return false;
            }

            if (year === currentYear && month < currentMonth) {
                return false;
            }

            return true;
        }

        // Mock implementation of CVV validation
        function isValidCVV(cvv) {
            return /^\d{3,4}$/.test(cvv); // CVV is typically 3 or 4 digits
        }

        function handleEnter(event, method, planName, planPrice) {
            if (event.key === 'Enter') {
                processPayment(method, planName, planPrice);
            }
        }

        function processPayment(method, planName, planPrice) {
            let isValid = true;
            let paymentForm = document.getElementById('paymentFormContainer').querySelector('form');

            // Validate the input based on the payment method
            let upiId = '';
            if (method === 'gpay' || method === 'phonepe') {
                let upiIdInput = document.getElementById('upiId');
                upiId = upiIdInput.value; // Capture UPI ID
                if (!isValidUPI(upiIdInput.value)) {
                    upiIdInput.classList.add('is-invalid');
                    isValid = false;
                } else {
                    upiIdInput.classList.remove('is-invalid');
                }
            } else if (method === 'credit_card') {
                let cardNumberInput = document.getElementById('cardNumber');
                let expiryDateInput = document.getElementById('expiryDate');
                let cvvInput = document.getElementById('cvv');

                if (!isValidCardNumber(cardNumberInput.value)) {
                    cardNumberInput.classList.add('is-invalid');
                    isValid = false;
                } else {
                    cardNumberInput.classList.remove('is-invalid');
                }

                if (!isValidExpiryDate(expiryDateInput.value)) {
                    expiryDateInput.classList.add('is-invalid');
                    isValid = false;
                } else {
                    expiryDateInput.classList.remove('is-invalid');
                }

                if (!isValidCVV(cvvInput.value)) {
                    cvvInput.classList.add('is-invalid');
                    isValid = false;
                } else {
                    cvvInput.classList.remove('is-invalid');
                }
            }

            if (isValid) {
                // Simulate payment success
                showPaymentSuccess(planName, planPrice, method === 'gpay' || method === 'phonepe' ? upiId : ''); // Pass UPI ID
            }
        }

        function showPaymentSuccess(planName, planPrice, upiId = '') {
            document.body.classList.add('blur');
            document.getElementById('overlay').style.display = 'block';
            document.getElementById('paymentSuccess').style.display = 'block';

            // Set the plan name and price in the success message
            document.getElementById('successPlanName').innerText = "Plan Name: " + planName;
            document.getElementById('successPrice').innerText = "Price: " + planPrice;

            // Set UPI ID if applicable
            document.getElementById('successUpiId').innerText = upiId ? "UPI ID: " + upiId : "";
            document.getElementById('successUpiId').style.display = upiId ? "block" : "none";

            // Generate a random transaction ID for the simulation
            document.getElementById('transactionId').innerText = generateTransactionId();
        }

        function closeSuccess() {
    document.body.classList.remove('blur');
    document.getElementById('overlay').style.display = 'none';
    document.getElementById('paymentSuccess').style.display = 'none';

    // Redirect to User_Profile-page.html
    window.location.href = 'User_Profile-page.html';
}


        function generateTransactionId() {
            const characters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
            let transactionId = '';
            for (let i = 0; i < 12; i++) {
                transactionId += characters.charAt(Math.floor(Math.random() * characters.length));
            }
            return transactionId;
        }
    </script>

</body>

</html>
